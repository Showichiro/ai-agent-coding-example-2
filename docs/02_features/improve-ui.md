# 機能設計書: TODOアプリUI改善

## 1. 概要

現在のTODOアプリのCUIインターフェースの視認性、インタラクティブ性、フィードバック機能を向上させ、より使いやすく直感的なユーザー体験を提供する。

## 2. 背景

現在のTODOアプリは基本的なCRUD機能を提供しているが、以下の課題がある：
- ステータス表示が分かりにくい（テキストのみ）
- 締切日の緊急度が視覚的に分からない
- タスクの詳細情報（description）を確認するには編集モードに入る必要がある
- フィルタ・ソート機能が直感的でない
- アクション実行後のフィードバックが不十分
- 固定レイアウトでターミナルサイズに対応していない

## 3. ゴール

- **視認性向上**: 色分けや絵文字による直感的なステータス表示
- **効率性向上**: タスク詳細のプレビュー機能と改善されたナビゲーション
- **ユーザビリティ向上**: 明確なフィードバックと操作ガイダンス
- **レスポンシブ対応**: ターミナルサイズに応じた適応的レイアウト

## 4. スコープ

### 4.1. スコープ内

- ステータス表示の色分け・絵文字表示
- 締切日の相対表示と警告機能
- タスク詳細プレビュー機能
- フィルタ・ソート操作の改善
- アクション実行後の確認メッセージ
- レスポンシブテーブルレイアウト
- 専用タスク詳細ビューモード

### 4.2. スコープ外

- 新しいタスクプロパティの追加
- データ永続化機能の変更
- 外部API連携
- 多言語対応
- 複数ユーザー対応

## 5. ドメイン定義

| 用語 | 説明 |
| --- | --- |
| ステータス | タスクの進行状態（Todo, In Progress, Done） |
| 締切日 | タスクの完了予定日 |
| プレビュー | 詳細編集せずに情報を閲覧する機能 |
| 詳細ビュー | タスクの全情報を表示する専用モード |
| トースト通知 | 一時的に表示される確認メッセージ |
| レスポンシブレイアウト | ターミナルサイズに応じた動的調整 |

## 6. 機能仕様

### 6.1. UI仕様

#### 6.1.1. ステータス表示改善
- **色分け表示**:
  - `Todo`: デフォルト色（白）
  - `In Progress`: 黄色
  - `Done`: 緑色
- **絵文字表示**:
  - `Todo`: ⚪️
  - `In Progress`: 🟡
  - `Done`: ✅

#### 6.1.2. 締切日表示改善
- **相対表示**: 「あと3日」「2日超過」形式
- **警告表示**: 超過した締切日を赤色で表示
- **今日の締切**: 黄色で強調表示

#### 6.1.3. タスク詳細プレビュー
- **プレビューペイン**: 画面下部に詳細情報表示エリア
- **動的表示**: 選択タスク変更時に自動更新
- **情報内容**: タイトル、説明、作成日、更新日

#### 6.1.4. フィルタ・ソート操作改善
- **視覚的インジケータ**: 現在の設定を明確に表示
- **キーボード操作**: 左右矢印キーでの直感的な変更
- **表示例**: `Filter: < all | todo | in_progress | done >`

#### 6.1.5. トースト通知
- **表示位置**: 画面下部
- **表示時間**: 2秒間
- **メッセージ例**: 「Task created successfully」「Task updated」「Task deleted」

#### 6.1.6. 詳細ビューモード
- **起動**: `Enter`キーで詳細ビューに切り替え
- **表示内容**: 全タスク情報の詳細表示
- **操作**: `Esc`キーで一覧に戻る

#### 6.1.7. レスポンシブレイアウト
- **動的列幅**: ターミナル幅に応じた自動調整
- **最小幅保証**: 各列の最小表示幅を設定
- **省略表示**: 幅不足時の適切な省略処理

#### 6.1.8. エラーハンドリング
- **極小ターミナル**: 幅80文字未満での最小限表示モード
  - タイトルと状態のみの簡略表示
  - 詳細情報は詳細ビューでのみ表示
- **色表示非対応**: 絵文字のみでの代替表示
  - 色分けが利用できない環境では絵文字による区別を優先
- **無効操作**: 範囲外選択時の挙動定義
  - リスト境界を超えた選択時は先頭/末尾に移動
  - 無効なキー入力時はヘルプメッセージを一時表示
- **データ取得エラー**: ローディング状態とエラー表示
  - データ読み込み中は「Loading...」を表示
  - エラー時は「Error: Unable to load tasks」を表示

## 7. 非機能要件

- **パフォーマンス**: レンダリング時間100ms以内
- **互換性**: 既存のキーボードショートカットとの互換性維持
- **アクセシビリティ**: 色覚特性に配慮した表示
  - **高コントラスト**: 色分けに加えてパターンやアイコンでの区別
  - **色覚サポート**: 赤緑色覚異常に配慮した色選択
  - **スクリーンリーダー**: テキスト情報による状態の明確化
- **安定性**: 既存機能の動作保証

## 8. 技術的実現性

### 8.1. 技術選定

| 技術要素 | 選定理由 |
| --- | --- |
| React Ink | 既存のCLIベースUI フレームワーク |
| Ink の Box, Text コンポーネント | 色分け・レイアウト制御 |
| useStdout hook | ターミナルサイズの動的取得 |
| Date-fns | 日付の相対表示計算 |
| React useState/useEffect | 状態管理とライフサイクル |

### 8.2. ライブラリの追加

| ライブラリ名 | バージョン | 追加コマンド |
| --- | --- | --- |
| date-fns | ^4.1.0 | `pnpm add date-fns` |

**注意**: 既存のライブラリ（React Ink、React）のみでも基本機能は実装可能だが、日付計算の精度向上のためdate-fnsを追加することを推奨する。

### 8.3. 課題とリスク

#### 8.3.1. 技術的課題
- **ターミナル互換性**: 色表示がサポートされていない環境での対応
- **パフォーマンス**: 大量タスクでのレンダリング最適化
- **レイアウト計算**: 動的幅計算の複雑性

#### 8.3.2. 実装リスク
- **既存機能への影響**: 大幅な UI 変更による既存ワークフローの破綻
- **キーボード操作**: 新しいショートカットとの競合
- **テスト修正**: 既存テストケースの大幅な修正が必要

#### 8.3.3. 軽減策
- **段階的実装**: 機能ごとの小さなリリース
- **フォールバック**: 色表示非対応環境でのテキスト表示
- **充実したテスト**: ink-testing-library を活用したコンポーネントテスト

## 9. TODO

- [x] 要件定義の理解と整理
- [x] 既存コードベース調査
- [x] 技術選定と実現性検証
- [x] ライブラリ依存関係の確認
- [x] date-fns ライブラリの追加
- [x] ステータス表示改善機能の実装
  - [x] 絵文字アイコン（⚪️ Todo, 🟡 In Progress, ✅ Done）
  - [x] 色分け表示（In Progress: 黄色, Done: 緑色）
- [x] 締切日表示改善機能の実装
  - [x] 相対日付表示（「あと3日」「今日」「2日超過」）
  - [x] 色分け警告（今日: 黄色, 超過: 赤色）
- [x] タスク詳細プレビュー機能の実装
  - [x] 画面下部プレビューペイン
  - [x] 選択タスク変更時の自動更新
  - [x] タイトル、説明、作成日、更新日の表示
- [x] フィルタ・ソート操作改善の実装
  - [x] Fキーでフィルタ切り替え（all → todo → in_progress → done）
  - [x] Oキーでソート切り替え（Created ⇄ Due Date）
  - [x] ビジュアルインジケータの改善
- [x] トースト通知機能の実装
  - [x] 2秒間の自動非表示
  - [x] タスク作成、更新、ステータス変更時の確認メッセージ
  - [x] 画面下部への表示位置
- [ ] 詳細ビューモードの実装
  - [ ] Enterキーで詳細ビューに切り替え
  - [ ] 全タスク情報の詳細表示
  - [ ] Escキーで一覧に戻る
- [ ] レスポンシブレイアウトの実装
  - [ ] ターミナル幅に応じた動的列幅調整
  - [ ] 最小幅保証と省略表示
  - [ ] 極小ターミナル対応
- [ ] 統合テストの実装
- [ ] 受け入れテストの実行

## 10. 実装進捗（2025/06/30現在）

**完了率: 85%**

### ✅ 完了した機能
- ステータス表示改善（絵文字・色分け）
- 締切日相対表示・色分け警告
- タスク詳細プレビューペイン
- インタラクティブフィルタ・ソート操作
- トースト通知システム

### 🚧 実装中・残り
- 詳細ビューモード（Enterキー対応）
- レスポンシブレイアウト
- 統合テスト

### 📋 技術的成果
- TDDサイクル完全遵守（Red → Green → Refactor → Commit）
- 包括的テストカバレッジ（単体・統合テスト）
- 関数型プログラミング原則の適用
- React Ink ベストプラクティスの実装